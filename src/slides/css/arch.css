@property --glow-r1 {
  syntax: '<length>';
  inherits: false;
  initial-value: 0px;
}

@property --glow-r2 {
  syntax: '<length>';
  inherits: false;
  initial-value: 0px;
}

@property --glow-c1 {
  syntax: '<color>';
  inherits: false;
  initial-value: transparent;
}

@property --glow-c2 {
  syntax: '<color>';
  inherits: false;
  initial-value: transparent;
}

:root {
  --c-a: hsla(0, 90%, 73%, 0.917);
  --c-b: hsl(275 100% 70%);
  --c-c: hsl(113, 100%, 80%);
  --c-collector: hsl(48 100% 60%); /* жёлтый */
  --badge: hsl(195 100% 82%);
  --dim: #bfc8d2;
  --ink: #e6eef6;
}

.svc--a {
  --svc: var(--c-a);
  --svc-prev: var(--dim);
}

/* у A нет родителя */
.svc--b {
  --svc: var(--c-b);
  --svc-prev: var(--c-a);
}

.svc--c {
  --svc: var(--c-c);
  --svc-prev: var(--c-b);
}

.svc--collector {
  --svc: var(--c-collector);
}

/* сопоставление цвета сервиса в --svc (касается рамки, точек, подписей) */
.svc--a .svc-frame,
.svc--a .dot,
.svc--a .span-label {
  --svc: var(--c-a);
}
.svc--b .svc-frame,
.svc--b .dot,
.svc--b .span-label {
  --svc: var(--c-b);
}
.svc--c .svc-frame,
.svc--c .dot,
.svc--c .span-label {
  --svc: var(--c-c);
}
.svc--collector .svc-frame,
.svc--collector .dot,
.svc--collector .span-label {
  --svc: var(--c-collector);
}

/* заголовки блоков */
.svc-title {
  font: 700 14px/1 'EuropaNuova', ui-sans-serif, system-ui;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  fill: var(--dim);
}

/* рамки: базовое и активное состояние (единые для сервисов и коллектора) */
.svc-frame {
  --glow-r1: 0px;
  --glow-r2: 0px;
  --glow-c1: transparent;
  --glow-c2: transparent;
  fill: rgba(8, 13, 20, 0.52);
  stroke-width: 3;
  stroke: var(--svc);
  filter: drop-shadow(0 0 var(--glow-r1) var(--glow-c1))
    drop-shadow(0 0 var(--glow-r2) var(--glow-c2));
  transition: filter 0.25s ease, stroke 0.25s ease, opacity 0.25s;
  opacity: 0.25;
  transition: --glow-r1 250ms ease, --glow-r2 250ms ease, --glow-c1 250ms ease,
    --glow-c2 250ms ease, opacity 250ms ease;
  will-change: filter, opacity;
}

.svc.active .svc-frame {
  opacity: 1;
  --glow-r1: 8px;
  --glow-r2: 22px;
  /* color-mix в Oklab даёт предсказуемую прозрачность/тон */
  --glow-c1: color-mix(in oklab, var(--svc) 60%, transparent);
  --glow-c2: color-mix(in oklab, var(--svc) 40%, transparent);
}

/* точки-спаны */
.dot {
  fill: #1b2735;
  stroke: none;
  filter: none;
  opacity: 0.6;
  transition: transform 0.2s ease, filter 0.2s ease, fill 0.2s ease,
    opacity 0.2s;
}
.dot.active {
  fill: #fff;
  opacity: 1;
  filter: drop-shadow(0 0 8px color-mix(in oklab, var(--svc) 65%, transparent))
    drop-shadow(0 0 18px color-mix(in oklab, var(--svc) 45%, transparent));
}
/* точка в коллекторе — тёплая заливка при активации */
.collector-dot.active {
  fill: #fff3b0;
}

/* подписи spanID */
.span-label {
  font: 700 11px/1 'EuropaNuova', ui-sans-serif, system-ui;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  fill: color-mix(in oklab, var(--svc, var(--badge)) 80%, white 20%);
  opacity: 0;
  transform: translateY(6px);
  transition: opacity 0.25s ease, transform 0.25s ease;
}
.span-label.active {
  opacity: 1;
  transform: translateY(0);
}

.trace-badge {
  opacity: 0;
  transform: translateY(-6px);
  transition: opacity 0.25s ease, transform 0.25s ease;
}
.svc .trace-badge {
  opacity: 0;
  transform: translate(var(--badge-enter-x, 0), var(--badge-enter-y, 0));
  transform-box: fill-box;
  transform-origin: center;
  transition-property: opacity, transform;
  transition-duration: 350ms, var(--badge-enter-dur, 350ms);
  transition-timing-function: ease, linear;
}

.svc--a .trace-badge {
  --badge-enter-x: 0px;
  --badge-enter-y: -16px;
  --badge-enter-dur: 350ms;
}

.svc--b .trace-badge,
.svc--c .trace-badge {
  --badge-enter-x: -200px;
  --badge-enter-y: 0px;
  --badge-enter-dur: 1000ms;
}

/* «прислали слева» */
.svc.active .trace-badge {
  opacity: 1;
  transform: translate(0, 0);
}

/* 3) Подсветка значения parent_span цветом предыдущего сервиса */
.badge-text .parent-val {
  fill: color-mix(in oklab, var(--svc-prev) 85%, white 15%);
  font-weight: 900;
  letter-spacing: 0.03em;
}

/* Необязательно: серый для NULL у корня */
.badge-text .null {
  fill: color-mix(in oklab, var(--dim) 90%, white 10%);
}

.badge {
  fill: rgba(0, 0, 0, 0.55);
  stroke: var(--badge);
  stroke-width: 1.5;
  filter: drop-shadow(
    0 0 8px color-mix(in oklab, var(--badge) 55%, transparent)
  );
}

.badge-text {
  font: 800 12px/1 'EuropaNuova', ui-sans-serif, system-ui;
  fill: color-mix(in oklab, var(--badge) 85%, white 15%);
  letter-spacing: 0.1em;
  text-transform: uppercase;
}

/* заголовок коллектора можно сделать ярче */
.svc--collector .svc-title {
  fill: #e9f4ff;
}

/* цвет для каждой uplink через currentColor */
#uplink-a {
  color: var(--c-a);
}

#uplink-b {
  color: var(--c-b);
}

#uplink-c {
  color: var(--c-c);
}

/* базовый стиль стрелок */
.uplink {
  fill: none;
  stroke: currentColor;
  stroke-width: 2.5;
  opacity: 0.25;
  transition: opacity 0.2s ease;
}

/* активный «пульс» экспорта: будем анимировать dashoffset */
.uplink.send {
  opacity: 1;
}

/* когда у пути проставлен --len, эта анимация сработает плавно */
.uplink {
  fill: none;
  stroke: currentColor;
}

.uplink .bg {
  fill: none;
  stroke: currentColor;
  stroke-width: 2.5;
  opacity: 0.25;
}

/* верхний слой: рисуем от начала к концу; скорость = var(--dur) */
.uplink .anim {
  fill: none;
  stroke: currentColor;
  stroke-width: 2.5;
  opacity: 0.25;
  stroke-dasharray: 1; /* весь путь = 1.0 */
  stroke-dashoffset: 1; /* скрыт полностью */
  transition: stroke-dashoffset var(--dur, 250ms) linear, opacity 250ms linear;
  will-change: stroke-dashoffset, opacity;
}
.uplink.send .anim {
  stroke-dashoffset: 0; /* дорисовать до конца */
  opacity: 1;
}

/* небольшая подсветка коллектора при активности */
.svc--collector.active .svc-frame {
  stroke: var(--c-collector);
  opacity: 1;
  filter: drop-shadow(
      0 0 8px color-mix(in oklab, var(--c-collector) 60%, transparent)
    )
    drop-shadow(
      0 0 22px color-mix(in oklab, var(--c-collector) 40%, transparent)
    );
}
